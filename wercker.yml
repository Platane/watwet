
box: node:8

build:
  steps:
    - script:
      name: install dependencies
      code: |
        npm install -g yarn
        export YARN_CACHE=$WERCKER_CACHE_DIR/yarn
        HOME=$YARN_CACHE yarn --pure-lockfile
        
    - script:
      name: build
      code: |
        export VERSION=`node -e "console.log(require('./package.json').version+'-'+(process.env.WERCKER_GIT_COMMIT||'').slice(0,10))"`
        yarn build

    - script:
      name: test
      code: yarn test

    - script:
      name: prepare
      code: |
        mv dist gh-pages
    
    - script:
      name: set up permalink
      cwd: gh-pages
      code: |
        echo '---' >> 404.html
        echo 'permalink: /404.html' >> 404.html
        echo '---' >> 404.html
        cat index.html >> 404.html
        
    - script:
      name: google property verification
      code: |
        mv src/asset/staticPages/* gh-pages/
    
deploy-pages:
  steps:
    - takuma7/gh-pages:
        token: $GH_TOKEN
        basedir: gh-pages